# JPA
- [1장 JPA 소개](#1장-JPA-소개)
- [2장 JPA 시작](#2장-JPA-시작)


## 1장 JPA 소개

JPA
- 자바 ORM 기술에 대한 API 표존 명세
- JPA 2.1을 구현한 ORM 프레임워크는 하이버네이트, EclipseLink, DataNuculeus가 있으며 하이버네이트가 가장 대중적
- ORM 프레임워크 : 객체와 관게형 데이터베이스 간의 차이를 중간에서 해결

JPA CRUD
1. 저장
- persisit() 메소드는 객체를 데이터베이스에 저장
- JPA가 객체와 매핑정보를 보고 적절한 INSERT SQL을 생성해서 데이터베이스에 전달

2. 조회
- find() 메소드는 객체 하나를 데이터 베이스에서 조회
- JPA는 객체와 매핑정보를 보고 적절한 SELECT SQL을 생성해서 데이터베이스에 전달하고 그 결과로 객체를 생성해서 반환

3. 수정
- 별도의 수정 메소드를 제공하지 않는다.
- 객체를 조회해서 값을 변경하면 트랜잭션을 커밋할 때, 데이터베이스에 적절한 UPDATE SQL이 전달

패러다임의 불일치
1. 상속
- 객체는 상속이라는 기능을 가지고 있지만, 테이블은 상속이라는 기능이 없기 때문에 JPA를 사용하지 않는다면 객체를 분해해야 한다.
- JPA는 persist() 메소드를 사용하면 객체를 분해해서 저장하고, find() 메소드를 사용하면 여러 테이블을 조인해서 필요한 데이터를 조회하고 그 결과를 반환한다.

2. 연관관계
- 객체는 참조를 사용해서 다른 객체와 연관관계를 가지고 참조에 접근해서 연관된 객체를 조회한다.
- 테이블은 외래 키를 사용해서 다른 테이블와 연관관계를 가지고 조인을 사용해서 연관된 테이블을 조회한다.
- JPA는 개발자가 설정한 관계에 따라 객체 저장시 외래 키로 변환해서 적절한 INSERT SQL을 데이터 베이스에 전달한다. 

3. 객체 그래프 탐색
- SQL을 직접 다루면 처음 실행하는 SQL에 따라 객체 그래프를 어디까지 탐색할 수 있는지 정해진다.
- 하지만 비즈니스 로직에 따라 사용하는 객체 그래프가 다르기에 언제 끊어질지 모를 객체 그래프를 함부로 탐색할 수는 없다.
- JPA는 지연 로딩을 사용해서 연관된 객체를 실제 객체를 사용하는 시점까지 데이터베이스 조회를 미루며, 지연 로딩을 투명하게 처리한다.

4. 비교
- 동일성 : 객체 인스턴스의 주소 값을 비교
- 동등성 : 객체 내부의 값을 비교
- JPA는 같은 트랜잭션일 때 같은 객체가 조회되는 것을 보장한다.

JPA를 사용해야 하는 이유
- 생산성 : 지루하고 반복적인 코드와 CRUD용 SQL을 개발자가 직접 작성하지 않는다.
- 유지보수 : 개발자가 작성해야 했던 SQL과 JDBC API 코드를 JPA가 대신 처리해주므로 유지보수해야 하는 코드 수가 줄어든다.
- 패러다임의 불일치 해결
  - 상속, 연관관계, 객체 그래프 탐색, 비교
- 성능 최적화
- 데이터 접근 추상화와 벤더 독립성
- 표준

## 2장 JPA 시작

매핑 어노테이션
1. @Entity
- 이 클래스를 테이블과 매핑한다는 것을 JPA 알림
2. @Table
- 엔티티 클래스에 매핑할 테이블 정보
- 생략하면 클래스 이름을 엔티티 이름으로 매핑
3. @Id
- 엔티티 클래스의 필드를 테이블의 기본 키에 매핑
4. @Column
- 필드를 컬럼에 매핑
5. 매핑 정보가 없는 필드
- 필드명을 사용해서 컬럼명으로 매핑
- 대소문자를 구분하는 데이터베이스를 사용하면 명시적으로 매핑해야 한다.

속성
1. JPA 표준 속성 : 특정 구현체에 종속되지 않는 속성
- javax.persistence.jdbc.drive : JDBC 드라이버
- javax.persistence.jdbc.user : 데이터베이스 접속 아이디
- javax.persistence.jdbc.password : 데이터베이스 접속 비밀번호
- javax.persistence.jdbc.url : 데이터베이스 접속 URL
2. 하이버네이트 속성 : 하이버네이트 전용 속성으로 하이버네이트에서만 사용 가능
- hibernae.dialect : 데이터베이스 방언 설정
- 방언은 특정 데이터베이스만의 고유한 기능으로, 데이터 베이스가 변경되어도 애플리케이션 코드를 변경할 필요 없이 데이터베이스 방언만 교체하면 된다.

애플리케이션 개발
1. 엔티티 매니저 설정
- 엔티티 매니저 팩토리 생성 : persistence.xml에서 이름이 jpabook인 영속성 유닛을 찾아서 엔티티 매니터 팩토리 생성, 애플리케이션 전체에서 딱 한번만 생성하고 공유해서 사용
- 엔티티 매니저 생성 : 엔티티 매니저 팩토리에서 엔티티 매니저 생성, 엔티티를 데이터베이스에 등록/수정/삭제/조회할 수 있음, 데이터베이스 커넥션과 밀접한 관계가 있으므로 스레드 간에 공유하거나 재사용하면 안된다.
- 종료 : 사용이 끝난 엔티티 매니저는 종료, 애플리케이션을 종료할 때에는 엔티티 매니저 팩토리 종료

2. 트랜잭션 관리
- JPA는 항상 트랜잭션 안에서 데이터를 변경
- 트랜잭션을 시작하려면 엔티티 매니저에서 트랜잭션 API를 받아와야 한다.
- 트랜잭션 API를 사용해서 비즈니스 로직이 정상 동작하면 트랜잭션을 커밋하고 예외가 발생하면 롤백

3. 비즈니스 로직

